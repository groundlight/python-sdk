<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">The Grime Guardian: Building Stateful Multi-camera applications with Groundlight | Groundlight</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://code.groundlight.ai/python-sdk/blog/grime-guardian"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="The Grime Guardian: Building Stateful Multi-camera applications with Groundlight | Groundlight"><meta data-rh="true" name="description" content="Groundlight has a Problem"><meta data-rh="true" property="og:description" content="Groundlight has a Problem"><meta data-rh="true" property="og:image" content="https://code.groundlight.ai/python-sdk/assets/images/gg_pfp-ffa4c07d6685865bf0165427946f42b0.png"><meta data-rh="true" name="twitter:image" content="https://code.groundlight.ai/python-sdk/assets/images/gg_pfp-ffa4c07d6685865bf0165427946f42b0.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-02-01T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="Groundlight Python SDK,Raspberry Pi,Multithreading,State Management"><link data-rh="true" rel="icon" href="/python-sdk/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://code.groundlight.ai/python-sdk/blog/grime-guardian"><link data-rh="true" rel="alternate" href="https://code.groundlight.ai/python-sdk/blog/grime-guardian" hreflang="en"><link data-rh="true" rel="alternate" href="https://code.groundlight.ai/python-sdk/blog/grime-guardian" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://code.groundlight.ai/python-sdk/blog/grime-guardian","mainEntityOfPage":"https://code.groundlight.ai/python-sdk/blog/grime-guardian","url":"https://code.groundlight.ai/python-sdk/blog/grime-guardian","headline":"The Grime Guardian: Building Stateful Multi-camera applications with Groundlight","name":"The Grime Guardian: Building Stateful Multi-camera applications with Groundlight","description":"Groundlight has a Problem","datePublished":"2024-02-01T00:00:00.000Z","author":{"@type":"Person","name":"Sunil Kumar","description":"Machine Learning Engineer","image":"https://a-us.storyblok.com/f/1015187/1000x1000/a265e322bd/kumars.jpg"},"image":{"@type":"ImageObject","@id":"https://code.groundlight.ai/python-sdk/assets/images/gg_pfp-ffa4c07d6685865bf0165427946f42b0.png","url":"https://code.groundlight.ai/python-sdk/assets/images/gg_pfp-ffa4c07d6685865bf0165427946f42b0.png","contentUrl":"https://code.groundlight.ai/python-sdk/assets/images/gg_pfp-ffa4c07d6685865bf0165427946f42b0.png","caption":"title image for the blog post: The Grime Guardian: Building Stateful Multi-camera applications with Groundlight"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://code.groundlight.ai/python-sdk/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/python-sdk/blog/rss.xml" title="Groundlight RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/python-sdk/blog/atom.xml" title="Groundlight Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WG1Q5X6F6L"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WG1Q5X6F6L",{})</script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/python-sdk/assets/css/styles.716e5df6.css">
<script src="/python-sdk/assets/js/runtime~main.32d69edd.js" defer="defer"></script>
<script src="/python-sdk/assets/js/main.f5a8c07f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/python-sdk/"><div class="navbar__logo"><img src="/python-sdk/img/favicon-32x32.png" alt="Groundlight Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/python-sdk/img/favicon-32x32.png" alt="Groundlight Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Groundlight</b></a><a class="navbar__item navbar__link" href="/python-sdk/docs/getting-started">Docs</a><a class="navbar__item navbar__link" href="/python-sdk/docs/guide">Guide</a><a class="navbar__item navbar__link" href="/python-sdk/docs/sample-applications">Applications</a><a href="/python-sdk/api-reference-docs/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/python-sdk/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/groundlight/python-sdk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/python-sdk/blog/grime-guardian">The Grime Guardian: Building Stateful Multi-camera applications with Groundlight</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/python-sdk/blog/confidence-intervals-for-balanced-accuracy">Tales from the Binomial Tail: Confidence intervals for balanced accuracy</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">The Grime Guardian: Building Stateful Multi-camera applications with Groundlight</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-02-01T00:00:00.000Z">February 1, 2024</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="https://a-us.storyblok.com/f/1015187/1000x1000/a265e322bd/kumars.jpg" alt="Sunil Kumar"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Sunil Kumar</span></div><small class="authorTitle_nd0D" title="Machine Learning Engineer">Machine Learning Engineer</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="groundlight-has-a-problem">Groundlight has a Problem<a href="#groundlight-has-a-problem" class="hash-link" aria-label="Direct link to Groundlight has a Problem" title="Direct link to Groundlight has a Problem">​</a></h2>
<p>Here at the Groundlight office we have a bit of a problem - sometimes we leave dirty dishes in the office sink. They pile up, and as the pile grows it becomes more and more tempting to simply add to the pile instead of cleaning it up. It was clear that the Groundlight office needed a “grime guardian” to save us from our messy selves. One day, I realized that this was the perfect problem to solve using Groundlight’s computer vision SDK. I could focus on developing the complex embedded application logic while Groundlight handled the computer vision. My design provided me with an opportunity to test out a handful of interesting design patterns, including deployment on a Raspberry Pi, multi-camera and multi-detector usage, a microservice-like architecture achieved via multithreading, and complex state handling.</p>
<figure><img src="/python-sdk/assets/images/gg_dirty_sink-1d11fc1f7aec8e358cfaf5db73216632.jpg"><figcaption><small><p>The Groundlight office sink, where dishes accumulate faster than git commits.</p></small></figcaption></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview-of-the-application---the-grime-guardian">Overview of the Application - The Grime Guardian<a href="#overview-of-the-application---the-grime-guardian" class="hash-link" aria-label="Direct link to Overview of the Application - The Grime Guardian" title="Direct link to Overview of the Application - The Grime Guardian">​</a></h2>
<p>The application I developed, the <strong>Grime Guardian</strong>, is designed to make it fun for the Groundlight team to clean up dishes that have been abandoned in the sink (<a href="https://github.com/sunildkumar/GrimeGuardian" target="_blank" rel="noopener noreferrer">source code</a>). Using two cameras, the application monitors the state of the office sink and the overall kitchen scene. If it recognizes that dirty dishes were left in the sink for over a minute, it posts a funny yet inspiring message and photo to a Discord server that alerts the Groundlight team and encourages someone to help. Then, while the dishes remain unattended it surveys the kitchen until it sees someone. Once someone comes to help, it posts a message and photo, celebrating them as a hero, giving everyone in the Discord server a chance to recognize them. While this is cheesy, it has made it a bit more fun for us to do the dishes!</p>
<figure><img src="/python-sdk/assets/images/gg_dirty_sink_notification-483bb0c49da0a6966de7fe79cafd708d.png"><figcaption><small><p>The Grime Guardian alerting the Groundlight Team through Discord</p></small></figcaption></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-of-a-sophisticated-groundlight-application">Architecture of a Sophisticated Groundlight Application<a href="#architecture-of-a-sophisticated-groundlight-application" class="hash-link" aria-label="Direct link to Architecture of a Sophisticated Groundlight Application" title="Direct link to Architecture of a Sophisticated Groundlight Application">​</a></h2>
<p>The Grime Guardian demonstrates how to build an advanced Groundlight application in a handful of ways:</p>
<ol>
<li><strong>Raspberry Pi Deployment</strong> - The Grime Guardian leverages our custom <a href="https://github.com/groundlight/groundlight-pi-gen" target="_blank" rel="noopener noreferrer">Raspberry Pi Image</a>, which makes it easy to deploy Groundlight applications on Raspberry Pi.</li>
<li><strong>Multiple Cameras</strong> - The Grime Guardian actively uses more than one camera to solve a problem (it has one camera pointed at the sink and one pointed at the general kitchen scene).</li>
<li><strong>Multiple Detectors</strong> - The Grime Guardian combines multiple Groundlight detectors to solve a problem.</li>
<li><strong>Microservice-like architecture via Multithreading</strong> - The Grime Guardian’s architecture is broken down into a handful of microservice-like processes - each running in a different thread on the same machine. This improves the app’s robustness and allows for more flexibility and scalability.</li>
<li><strong>Complex State</strong> - As described in the previous section, the state of the world this app is tracking is somewhat complex. In addition to knowing the state of the sink and kitchen, the app tracks how recently the state was updated and how recently it has sent a notification to the Groundlight team.</li>
<li><strong>Discord Bot Integration/Notifications</strong> - The Grime Guardian uses the Discord Bot API to send notifications to a Discord server. Discord can be an extremely powerful and flexible tool for building applications (e.g. Midjourney).</li>
<li><strong>Robustness</strong> - In practice, the Grime Guardian has been extremely robust, with only one or two incorrect (false positive) notifications over many weeks of deployment and hundreds of thousands of Groundlight queries.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="microservice-like-architecture">Microservice-like Architecture<a href="#microservice-like-architecture" class="hash-link" aria-label="Direct link to Microservice-like Architecture" title="Direct link to Microservice-like Architecture">​</a></h2>
<p>The Grime Guardian leverages a microservice-like architecture via multithreading to enhance its performance and robustness. Each microservice within the application runs in its own thread on a single Raspberry Pi, allowing for simultaneous execution of tasks. This architecture is particularly beneficial in this context as it allows the application to monitor the sink and the kitchen scene concurrently using two cameras, and to process the data from these cameras independently. Furthermore, it enables the application to manage complex state tracking and Discord notifications without blocking or slowing down the image processing tasks.</p>
<p>The application is broken into six microservices:</p>
<ol>
<li><strong>Sink Image Capturer</strong>: This microservice captures images from a camera pointed at the sink and submits them as queries to a Groundlight detector via the <code>ask_async</code> SDK method (this method is useful for times in which the thread submitting image queries is not the same thread that will be retrieving and using the results). I set the detector&#x27;s query to &quot;Is there at least one dish in the sink? Cleaning supplies like a sponge, brush, soap, etc. are not considered dishes. If you cannot see into the sink, consider it empty and answer NO&quot; and set the confidence threshold to 75%. After Groundlight replies with a query ID, the service passes the query ID to the <strong>Query Processor</strong> service.</li>
<li><strong>Kitchen Image Capturer</strong>: This microservice is identical to the <strong>Sink Image Capturer</strong> except it uses the camera that can view the whole kitchen and submits images to a detector with the query &quot;Is there at least one person in this image?&quot; and set the confidence threshold to 75% as well.</li>
<li><strong>Query Processor</strong>: This microservice processes the queries passed to it by the two <strong>Capturer</strong> services, waiting for confident answers from Groundlight and filtering out queries that do not become confident within a reasonable time (I chose a 10 second timeout as that was how frequently each <strong>Capturer</strong> service submitted a query to Groundlight). Queries that become confident are passed to the <strong>State Updater</strong> service.</li>
<li><strong>State Updater</strong>: This microservice updates a complex model of the application&#x27;s state based on Groundlight&#x27;s responses. It tracks the status and last update time of the sink and kitchen, the image query IDs that led to the current state, and the timestamps of the last clean sink and notifications sent.</li>
<li><strong>Notification Publisher</strong>: This microservice listens for updates to the state of the application (written by the <strong>State Updater</strong>) and decides whether it is appropriate to send one of two possible notifications. If a notification is needed, it adds it to a queue of notifications to be processed by the <strong>Discord Bot</strong>. Importantly, the <strong>Notification Publisher</strong> only determines if a notification should be sent. It does not handle the mechanics of what data to send or how and where to send it.</li>
<li><strong>Discord Bot</strong>: This microservice runs a Discord bot, which listens for requests from the <strong>Notification Publisher</strong>. When a request arrives, the bot collects the relevant data and sends notifications to a Discord server.</li>
</ol>
<figure><img src="/python-sdk/assets/images/gg_arch_flow-293787a330013e3e0ac1bf378a333c9e.png"><figcaption><small><p><small>Diagram created by Jared Randall</small><br>Architecture diagram for the application</p></small></figcaption></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="state-management-and-notification-logic">State Management and Notification Logic<a href="#state-management-and-notification-logic" class="hash-link" aria-label="Direct link to State Management and Notification Logic" title="Direct link to State Management and Notification Logic">​</a></h2>
<p>The Grime Guardian&#x27;s ability to track and manage a complex state is a cornerstone of its functionality. The application not only needs to know the current state of the sink and kitchen but also when these states were last updated and when the last notifications were sent. In total, the application needs nine separate variables to function properly (a combination of binary-encoded state fields, timestamps, and image query IDs).  This level of detail is crucial for avoiding redundant alerts and ensuring timely and accurate updates.</p>
<p>As seen in the architecture diagram in the previous section, multiple services read and write to the state simultaneously. To handle this complexity, I implemented a wrapper around the state to handle reads and writes in a thread safe manner. This wrapper ensures the state can be accessed and modified safely across many services. It uses a lock to prevent race conditions, ensuring that only one thread can modify the state at a time.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> threading</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> copy</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># simplified version of how the Grime Guardian manages state safely</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">SimpleThreadSafeState</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">__init__</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">state </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">lock </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> threading</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">update_state</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> new_state</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">bool</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">with</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">state </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> new_state</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">get_state</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">bool</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">with</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The application uses this state to determine when to send notifications. I&#x27;ve tried to break down this logic into a few of flowcharts. At a high level, the logic is pretty simple. Whenever the the application&#x27;s state is updated, the application performs a check to determine if the new state justifies sending each type of notification.</p>
<figure><img src="/python-sdk/assets/images/gg_notification_flow-af7366a7a2053313d95868c8043115ee.png"><figcaption><small><p><small>Diagram created by Jared Randall</small><br>High level flow for determining if a notification should be sent</p></small></figcaption></figure>
<p>The logic for determining if each notification should be sent is a bit more complex. It first checks for the last time a notification was sent. If the last notification was sent in the last 5 minutes, no notification is sent. This is important as it prevents the application from spamming the Discord server with notifications. Next, the application checks if the sink currently has dirty dishes in it, and how long it has been since the sink was empty. We only send the notification if dirty dishes have been present for more than a minute. This approach ensures that the Grime Guardian does not send a notification every time someone puts a dirty dish in the sink, but only when dishes have been abandoned for a while. This ensures that the app only notifies the team when it is actually needed.</p>
<figure><img src="/python-sdk/assets/images/gg_dishes_notification_flow-2cb76e1aef6d5f040817c33364b9260a.png"><figcaption><small><p><small>Diagram created by Jared Randall</small><br> Flow for determining if the dirty dishes notification should be sent</p></small></figcaption></figure>
<p>The logic for determining if someone has arrived to help is similar. We have a check that ensures we do not spam the Discord server. Then, we only send a notification if there are currently dishes in the sink and someone is present in the kitchen. This ensures that the Grime Guardian does not send a notification every time someone walks into the kitchen, but only when dishes are in the sink.</p>
<figure><img src="/python-sdk/assets/images/gg_help_arrived_flow-7bcfe14e030537866c6bd15daebd6115.png"><figcaption><small><p><small>Diagram created by Jared Randall</small><br> Flow for determining if the help arrived notification should be sent</p></small></figcaption></figure>
<p>In retrospect, getting the notification logic to work properly was one of the more challenging parts of this project. The version I presented here is the result of many iterations and tweaks based on real world usage and results. I think this is because this logic is an expression of the application&#x27;s core value proposition. If this &quot;business logic&quot; is not correct, the application will not be fun or useful. Fortunately, Groundlight enabled me to focus on this logic and not worry about the computer vision.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="discord-bot-notifications">Discord Bot Notifications<a href="#discord-bot-notifications" class="hash-link" aria-label="Direct link to Discord Bot Notifications" title="Direct link to Discord Bot Notifications">​</a></h2>
<p>The Grime Guardian uses the <a href="https://discord.com/developers/docs/intro" target="_blank" rel="noopener noreferrer">Discord Bot API</a> to send notifications to a Discord server I set up. At startup, Discord requires some boilerplate to handle authentication. After this is done, the bot listens for new notification requests from the <strong>Notification Publisher</strong>. Based on the type of request, the bot collects the relevant information (e.g. the image of the dirty sink, or the person doing the dishes) and sends the message. The Discord Bot API makes this incredibly simple, after handling authentication, a new message and an attached image can be sent in a single line.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> channel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;message&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">file</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">discord</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">fpath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>While I did not have time to add more complexity to the bot, Discord’s strong documentation gives me confidence it would not be that hard to add more features. For example, it would have been nice if the bot could listen for replies or emote reactions to its notifications - if the bot reported that the sink was full of dishes when really it was not, I could react to the notification with an emote that indicates the correct label for the image, and then the bot could automatically send this information to Groundlight, improving ML performance.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-improvements-and-enhancements">Future Improvements and Enhancements<a href="#future-improvements-and-enhancements" class="hash-link" aria-label="Direct link to Future Improvements and Enhancements" title="Direct link to Future Improvements and Enhancements">​</a></h2>
<p>Extending the functionality of the application, I can imagine adding motion detection to limit the frequency of image submissions to Groundlight. Currently, the application sends images to Groundlight at a fixed interval (every 10 seconds), regardless of whether there has been any significant change in the scene. This approach, while simple, could be optimized to become more cost effective. As it is now, it can lead to unnecessary image submissions when the scene is static. By incorporating motion detection, the application could intelligently decide when to send images to Groundlight. Fortunately, some of my excellent colleagues have built <a href="https://github.com/groundlight/framegrab/" target="_blank" rel="noopener noreferrer"><code>framegrab</code></a>, an open source tool that automatically handles this.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-your-own-grime-guardian">Build Your Own Grime Guardian<a href="#build-your-own-grime-guardian" class="hash-link" aria-label="Direct link to Build Your Own Grime Guardian" title="Direct link to Build Your Own Grime Guardian">​</a></h2>
<p>Thank you for taking the time to read my post! As I reflect back, I’m very proud of how Groundlight enabled me to very quickly and effortlessly stand up an ML solution to solve a simple office problem in a fun and engaging way! If you are particularly interested or inspired, I encourage you to check out the <a href="https://github.com/sunildkumar/GrimeGuardian" target="_blank" rel="noopener noreferrer">source code</a>. Feel free to open a GitHub issue with questions or submit a PR with improvements!</p>
<figure><img src="/python-sdk/assets/images/gg_hero_notification-eaffe18fcd64c4f75d6e6db50e237033.png"><figcaption><small><p>The Grime Guardian celebrates Tom, my colleague, for his heroic cleaning effort. The grime is no match for his dish-defeating determination!</p></small></figcaption></figure></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/python-sdk/blog/tags/groundlight-python-sdk">Groundlight Python SDK</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/python-sdk/blog/tags/raspberry-pi">Raspberry Pi</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/python-sdk/blog/tags/multithreading">Multithreading</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/python-sdk/blog/tags/state-management">State Management</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/groundlight/python-sdk/tree/main/docs/blog/blog/2024-02-01-grime-guardian.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/python-sdk/blog/confidence-intervals-for-balanced-accuracy"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Tales from the Binomial Tail: Confidence intervals for balanced accuracy</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#groundlight-has-a-problem" class="table-of-contents__link toc-highlight">Groundlight has a Problem</a></li><li><a href="#overview-of-the-application---the-grime-guardian" class="table-of-contents__link toc-highlight">Overview of the Application - The Grime Guardian</a></li><li><a href="#architecture-of-a-sophisticated-groundlight-application" class="table-of-contents__link toc-highlight">Architecture of a Sophisticated Groundlight Application</a></li><li><a href="#microservice-like-architecture" class="table-of-contents__link toc-highlight">Microservice-like Architecture</a></li><li><a href="#state-management-and-notification-logic" class="table-of-contents__link toc-highlight">State Management and Notification Logic</a></li><li><a href="#discord-bot-notifications" class="table-of-contents__link toc-highlight">Discord Bot Notifications</a></li><li><a href="#future-improvements-and-enhancements" class="table-of-contents__link toc-highlight">Future Improvements and Enhancements</a></li><li><a href="#build-your-own-grime-guardian" class="table-of-contents__link toc-highlight">Build Your Own Grime Guardian</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/python-sdk/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/python-sdk/docs/guide">Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/python-sdk/docs/installation">Installation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.groundlight.ai/" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.groundlight.ai/team" target="_blank" rel="noopener noreferrer" class="footer__link-item">Team<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.groundlight.ai/careers" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://dashboard.groundlight.ai/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sign In<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Code</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/groundlight/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://pypi.org/project/groundlight/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/groundlight/stream" target="_blank" rel="noopener noreferrer" class="footer__link-item">Video Streaming<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/groundlight/esp32cam" target="_blank" rel="noopener noreferrer" class="footer__link-item">Arduino / ESP32<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Groundlight AI.</div></div></div></footer></div>
</body>
</html>